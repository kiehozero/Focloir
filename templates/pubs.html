{% extends "main.html" %}

    <!-- Template to view all pubs in a grid index. Additional
        admin features include editing and deleting a pub-->

    {% block title %}
        Pubs
    {% endblock %}

    {% block content %}

    <!-- Search box taken from Code Institute task manager tutorial -->
    <div class="row center-align">
        <div class="col s12 m8 offset-m1">
            <form action="{{ url_for('search_pubs') }}" method="POST">
                <div class="row valign-wrapper">

                    <!-- Search Box -->
                    <div class="input-field col s12 offset-s1 offset-m4">
                        <input name="search" id="search" minlength="3"
                            class="validate" type="text" required>
                        <label for="search">Search</label>
                    </div>

                    <!-- Buttons -->
                    <div class="col s12">
                        <button type="submit" class="btn search-button" id="searchButton">
                            Search
                        </button>
                        <a href="{{ url_for('pubs') }}" class="btn search-button" id="searchReset">
                            Reset
                        </a>
                    </div>

                </div>
            </form>
        </div>
    </div>

    <div class="row">
        <div class="col s12 m8 offset-m2">

            <!-- First tile is always the choice to add a new review -->
            <div class="col s12 m4">
                <div class="card">
                    <div class="card-image">
                        <img src="{{ url_for('static', filename='images/pintbaby-bg.png') }}">
                        <span class="card-title">Add a new pub</span>
                        <a 
                            class="btn-floating halfway-fab waves-effect waves-light right"
                            href="{{ url_for('add_pub') }}">
                            <i class="fas fa-pen-nib"></i>
                        </a>
                    </div>
                    <div class="card-content spectral">
                        <p>
                            {% if pubs|length == 0 %}
                                No pintbabies have visited this location, click the pen to add it!
                            {% else %}
                                Click the pen above to add a pub!
                            {% endif %}
                        </p>
                    </div>
                </div>
            </div>

            {% for pub in pubs %}
                <div class="col s12 m4">
                    <div class="card">
                        <div class="card-image">
                        <img src="{{ url_for('static', filename='images/pintbaby-bg.png') }}">
                        <span class="card-title">{{ pub.pname }}</span>
                        <a
                            class="btn-floating halfway-fab waves-effect waves-lightleft"
                            href="{{ url_for('add_review_of', pub_id=pub._id) }}">
                            <!--paramter above needs to be pub id-->
                            <!-- generate link here from pub id, a new template of the add_review that is pre-filled? -->
                            <div 
                                style="font-family: 'Fraunces'; font-weight: 600; font-size: 20px; text-align: center;">
                                <i class="fas fa-pen-nib"></i>
                            </div>
                        </a>
                        <a
                            class="btn-floating halfway-fab waves-effect waves-light"
                            href="{{ url_for('view_pub', pub_id=pub._id) }}">
                            <i class="fas fa-book-open"></i>
                        </a>
                        </div>
                        <div class="card-content spectral">
                        <p>
                            {{ pub.city }}
                            <br>
                            {{ pub.country }}
                            <br>
                        </p>
                        </div>

                        {% if session.user == "pbadmin" %}
                            <!-- edit button that contains additional user form option for user, this 
                            will need to be pre-filled with the original editor's username so it isn't 
                            overwritten with the admin's name, same as moderate_review function -->
                            <!-- below will need to be a new admin_edit_pub function-->
                            <div class="center-align admin-panel">
                                <!-- Bugfix #10: JS icon class/ids -->
                                <a 
                                    class="btn review-card-button admin-moderate"
                                    href="{{ url_for('edit_pub', pub_id=pub._id) }}">
                                    Edit
                                </a>

                                <a 
                                    class="btn delete-button admin-delete"
                                    href="{{ url_for('delete_pub_admin', pub_id=pub._id) }}">
                                    Delete
                                </a>
                            </div>
                            <!-- styling in some margin bottom padding -->
                        {% endif %}

                    </div>
                </div>
            {% endfor %}

        </div>
    </div>

    {% endblock %}